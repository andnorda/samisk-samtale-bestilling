"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.devRender = exports.prodRender = void 0;
const templateBuilder_1 = require("./templateBuilder");
// @ts-ignore (this file is generated by vite build)
const main_server_1 = require("../../_ssr-dist/main-server");
const processTemplate = async (templateHtml, appHtml, appContext = {}) => {
    return templateHtml
        .replace('<!--ssr-app-html-->', appHtml)
        .replace('"ssr-app-context"', JSON.stringify(appContext));
};
const prodRender = async (url, context) => {
    try {
        const template = await (0, templateBuilder_1.buildHtmlTemplate)();
        const appHtml = (0, main_server_1.render)(url, {});
        return processTemplate(template, appHtml, context);
    }
    catch (e) {
        console.error(`Rendering failed ${e}`);
        return '';
    }
};
exports.prodRender = prodRender;
const devRender = (vite) => async (url, context) => {
    try {
        const template = await (0, templateBuilder_1.buildHtmlTemplate)();
        const { render } = await vite.ssrLoadModule('/src/main-server.tsx');
        const appHtml = render(url, context);
        const html = await vite.transformIndexHtml(url, template);
        return processTemplate(html, appHtml, context);
    }
    catch (e) {
        vite.ssrFixStacktrace(e);
        console.error(`Dev render error: ${e}`);
        return '';
    }
};
exports.devRender = devRender;
